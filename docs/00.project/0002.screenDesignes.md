# 画面設計書: Xenharmonic Voyager

| ドキュメントバージョン | 作成日     | 更新日     | 更新者             |
| :--------------------- | :--------- | :--------- | :----------------- |
| 1.0.0                  | 2025/10/08 | 2025/10/08 | セレーネ（開発用） |

## 1\. アプリケーション画面概要

本アプリケーションは、単一の画面で構成される。画面は大きく**サイドバー**と**メインエリア**に分割され、ユーザーはサイドバーで音響モデルのパラメータを設定し、メインエリアで分析したい和音を構成し、その結果をリアルタイムに確認する。「パラメータの変更が即座に結果に反映される」というインタラクティブな体験を重視し、ユーザーの試行錯誤を促進する。

## 2\. 画面構成

画面は 2 カラムレイアウトを採用する。サイドバーは設定項目に特化して幅を抑え、メインエリアを広く確保することで、主役である音選択 UI と計算結果の視認性を高める。

```
+----------------+-------------------------------------------------------------+
|                |                                                             |
| [SIDEBAR]      | [MAIN AREA]                                                 |
|                |                                                             |
|                |       Xenharmonic Voyager - [簡単な説明]                     |
|   Setting      |                                                             |
|     　　　　    |                                                             |
|                | +---------------------------------------------------------+ |
| ---------------- | | [UI-M-01] 音選択UI (横型ステップセレクター)             | |
|                | |  [ 0 ] [ 1 ] [ 2 ] [ 3 ] ... [ N-1 ]                    | |
| [UI-S-01]      | +---------------------------------------------------------+ |
| EDO選択        |                                                             |
| (Selectbox)    | +----------------------+ +--------------------------------+ |
|                | | [UI-M-02]            | | [UI-M-02]                      | |
| [UI-S-02]      | | ラフネススコア       | | 協和度 比較ゲージ              | |
| 構成音数       | | (Metric)             | | (Progress Bar)                 | |
| (Selectbox)    | +----------------------+ +--------------------------------+ |
|                |                                                             |
|                | +---------------------------------------------------------+ |
|                | | ▼ [UI-M-03] 計算の詳細 (Expander)                       | |
|                | +---------------------------------------------------------+ |
|                |                                                             |
|                | +---------------------------------------------------------+ |
|                | | ▼ [UI-M-04] この計算について (Expander)                 | |
|                | +---------------------------------------------------------+ |
|                |                                                             |
+----------------+-------------------------------------------------------------+
```

## 3\. コンポーネント仕様

### 3.1. サイドバー (入力・設定機能)

| ID          | 機能概要             | Streamlit コンポーネント | 詳細仕様                                                                                                                                                                                             |
| :---------- | :------------------- | :----------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UI-S-01** | **音律選択機能**     | `st.selectbox`           | **目的:** 分析の基準となる音律を選択する。<br>**振る舞い:** 値が変更されると、メインエリアの音選択 UI (`UI-M-01`) のステップ数が即座に更新され、計算結果も再計算される。MVP では 12-EDO, 19-EDO のみ |
| **UI-S-02** | **和音構成音数選択** | `st.selectbox`           | **目的:** 分析対象とする和音の構成音数を決定する。<br>**振る舞い:** 値が変更されると、音選択 UI (`UI-M-01`) で選択可能な音の数が更新され、計算結果も再計算される。MVP では 2,3,4 音のみ              |

### 3.2. メインエリア (操作・可視化機能)

| ID          | 機能概要               | Streamlit コンポーネント     | 詳細仕様                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| :---------- | :--------------------- | :--------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UI-M-01** | **音選択 UI**          | `st.columns` + `st.button`   | **目的:** 分析対象の和音を構成する音を、視覚的・直感的に選択する。<br>**仕様:**<br>・`UI-S-01`で選択された EDO のステップ数と同じ数のボタン(`[0]`から`[N-1]`)を横一列に表示する。<br>・ユーザーは`UI-S-02`で指定した数だけ音を選択できる。<br>・ボタンクリックで音を選択/選択解除する。<br>・選択中の音のボタンは、明確に識別できるスタイル（例: `st.button(type="primary")`）を適用する。<br>・**選択数が上限に達している状態で未選択の音をクリックすると、最初に選択された音は固定されたまま、最後に選択された音が自動で解除され、新しい音が選択される。**これにより、和音の根音（最初の音）を保持したまま、他の音を試行錯誤できる。                                                                                                                                                                                                                                                                                                                                         |
| **UI-M-02** | **協和度スコア表示**   | `st.metric`<br>`st.progress` | **目的:** 計算された協和度を、絶対値と相対値の両方でユーザーに提示する。<br>**仕様:**<br>1. **ラフネススコア (`st.metric`):**<br> ・「音響的ラフネス」というラベルと共に、計算された生スコアを大きく表示する。<br> ・ヘルプテキストで「値が低いほど、響きが澄んでいる（協和的）ことを示します」と補足する。<br>2. **協和度 比較ゲージ (`st.progress`):**<br> ・**文化的・聴覚的な「ものさし」** を提供し、未知の響きを直感的に理解するのを助ける。<br> ・ゲージは、**12-EDO の長三和音 ([0, 4, 7]) のラフネススコアを「基準点（0%）」** とし、**完全に濁った状態を「最大値（100%）」** として正規化する。<br> ・現在選択中の和音のスコアが、このゲージ上でどの位置にあるかをバーで表示する。<br> ・**例:** 12-EDO 長三和音より協和的ならバーはほぼ 0 に、より不協和ならバーが伸びる。これにより、ユーザーは馴染みのある響きと比較して、現在の響きの性質を瞬時に判断できる。 |
| **UI-M-03** | **計算パラメータ詳細** | `st.expander`                | **目的:** 現在の計算結果が、どのような前提条件に基づいているかを明示し、分析の透明性を確保する。<br>**仕様:**<br>・デフォルトでは折りたたまれている。<br>・展開すると、現在の計算に使用されている全パラメータ（音律、選択音、使用モデル、音色モデル、考慮倍音数）がリスト形式で表示される。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **UI-M-04** | **計算ロジック解説**   | `st.expander`                | **目的:** アプリケーションの動作原理に関する学術的な背景を提供し、ユーザーの知的好奇心に応える。<br>**仕様:**<br>・デフォルトでは折りたたまれている。<br>・音響的ラフネスの理論的背景や、Sethares モデルの概要を解説する。図や数式も交え、専門知識がないユーザーにも雰囲気が伝わるように記述する。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

## 4\. 設計・実装方針

- **インタラクティブ性の担保:** ユーザーがサイドバーのパラメータ、またはメインエリアの音選択 UI を操作した場合、画面全体は自動的に再計算・再描画される。「計算実行」のようなボタンは設置せず、即時フィードバックによるスムーズな体験を提供する。
- **音選択 UI の段階的実装:**
  1.  **MVP:** `st.columns` と `st.button` を用いた**横型ステップセレクター**を実装する。これにより、迅速な機能提供を優先する。
  2.  **将来的な展望:** Streamlit のカスタムコンポーネント機能を活用し、より直感的で没入感のある**円環型ピッチセレクター**の実装を目指す。
- **関心の分離:** UI を定義する `app.py` と、協和度計算のコアロジックを担う `src/calculator.py` の役割を明確に分離し、保守性とテスト容易性を確保する。
