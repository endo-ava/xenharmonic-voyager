# プロジェクト概要

**Xenharmonic Voyager** は、12平均律以外の音響宇宙（Xenharmonic）を探求するための実験的なWebアプリケーションです。ユーザーが指定したN-EDO (N Equal Divisions of the Octave, N平均律) の音律と和音に対し、その響きの「協和度」を音響心理学モデル（Setharesモデル）に基づいてリアルタイムに計算し、可視化します。

感性や慣習に頼るのではなく、倍音の物理的な干渉（ラフネス）という観点から、響きの美しさを定量的に探求するための「観測装置」として機能します。

# 技術スタック

## アプリケーション本体

- **Python 3.13+**: アプリケーション全体の記述言語
- **Streamlit**: インタラクティブなUIの構築およびWebサーバー機能
- **NumPy**: 周波数計算、倍音列生成など、高速な配列演算
- **Pydantic**: 計算ロジックへの入力値の検証による堅牢性向上

## 開発・品質管理

- **uv**: Python依存管理・仮想環境・バージョン管理の統合ツール
- **Ruff**: 超高速な静的コード解析とコードフォーマット
- **pre-commit**: コミット前のLint/Format自動実行によるコード品質の強制
- **Pytest**: 計算ロジックの正しさを保証するための単体テスト
- **Git / GitHub**: バージョン管理とCI/CD

## デプロイ

- **Streamlit Community Cloud**: アプリケーションのホスティング

# 主要な開発コマンド

```bash
# 依存関係のインストール（開発依存含む）
uv sync

# Streamlitアプリケーションの起動（開発サーバー）
uv run streamlit run app.py

# Lintとフォーマットのチェック
uv run ruff check .
uv run ruff format --check .

# 自動フォーマット適用
uv run ruff format .

# テストの実行
uv run pytest

# カバレッジ付きテスト実行
uv run pytest --cov=src --cov-report=html

# pre-commitフックのインストール
uv run pre-commit install

# pre-commitフックの手動実行
uv run pre-commit run --all-files
```

# ドキュメント体系

## ドキュメントの意義とAIへの指針

本プロジェクトにおいて、ドキュメントは単なる記録ではなく、\*\*プロジェクトの思想と決定を写す「生きた設計図」**である。コードが「どのように(How)」を表現するのに対し、ドキュメントは**「なぜ(Why)」**と**「何を(What)」\*\*を記録する。これにより、将来の意思決定の質を高め、開発の一貫性と保守性を担保する。

**AI開発パートナーへの指針:**
あなた（AI）は、このドキュメント体系の最も重要な利用者であり、同時に保守者でもある。以下の指針を常に念頭に置いて開発支援を行うこと。

1.  **参照の徹底 (Read Before Write):** コード生成、リファクタリング、設計提案など、いかなる提案を行う前にも、必ず関連するドキュメントを深く読み込み、その内容を完全に尊重すること。ドキュメントは、プロジェクトにおける\*\*信頼できる唯一の情報源（Single Source of Truth）\*\*である。
2.  **同期の維持 (Sync Code and Docs):** あなたの提案によって既存の設計や規約が変更される場合は、コードの変更提案と**同時にドキュメントの更新案を提示する**こと。コードとドキュメントの乖離は、プロジェクトの技術的負債となる。
3.  **知識の集約 (Accumulate Knowledge):** 開発過程で得られた新たな知見や解決策、議論の末に決定された事項は、単なるチャットログで終わらせず、`docs/70.knowledge/` や関連ドキュメントへの追記を積極的に提案すること。あなたの支援を通じて、このプロジェクトの知識ベースを共に成長させることを期待する。

## ドキュメント番号体系

各ドキュメントには4桁のドキュメント番号を付与し、カテゴリと内容を即座に識別できるようにしている。

**番号範囲**:

- **00xx**: プロジェクト基本情報 (0001-0099)
- **10xx**: ドメイン設計 (1001-1999)
- **20xx**: 開発ガイドライン (2001-2999)
- **30xx**: 品質・プロセス (3001-3999)
- **70xx**: ナレッジベース (サブディレクトリで管理)
- **80xx**: 日報 (日付ベース命名)
- **99xx**: テンプレート (サブディレクトリで管理)

例: `2003` = 開発ガイドライン分野の3番目のドキュメント

## ドキュメントインデックス（一覧）

| カテゴリ             | ファイル                           | 相対パス                                                                                             |
| -------------------- | ---------------------------------- | ---------------------------------------------------------------------------------------------------- |
| プロジェクト基本情報 | 要件定義                           | [`docs/00.project/0001.requirements.md`](docs/00.project/0001.requirements.md)                        |
| プロジェクト基本情報 | アーキテクチャ・実装               | [`docs/00.project/0002.architecture-implementation.md`](docs/00.project/0002.architecture-implementation.md) |
| ドメイン設計         | 数学的基礎                         | [`docs/10.domain/1001.mathematical-foundation.md`](docs/10.domain/1001.mathematical-foundation.md)     |
| 品質・プロセス       | Git・PR                            | [`docs/30.quality/3002.git-pr.md`](docs/30.quality/3002.git-pr.md)                                    |
| ナレッジ             | MVP計算エンジン計画                | [`docs/70.knowledge/7001.mvp-calculation-engine-plan.md`](docs/70.knowledge/7001.mvp-calculation-engine-plan.md) |
| 日報                 | テンプレート                       | [`docs/80.dailyReport/template.md`](docs/80.dailyReport/template.md)                                  |

# 開発ワークフローと参照ドキュメント

新規機能開発、リファクタリング、不具合修正など、すべての開発作業はこのフローに沿って進める。各フェーズで参照すべきドキュメントを必ず確認し、プロジェクト全体の一貫性を保つこと。

### **Phase 1: 企画・タスク着手**

**目的**: これから何を、なぜ作るのかを正確に理解し、開発の準備を整える。

作業を開始する前に、まずIssueやタスクの背景を完全に理解する。要件や仕様が不明瞭な場合は、実装に着手する前に必ず確認すること。

---

### **Phase 2: 設計**

**目的**: 実装に着手する前に、どのように作るかを決定する。システムの保守性と拡張性を担保するための最も重要なフェーズ。

アーキテクチャや設計原則に立ち返り、新しいコードが既存のシステムとどのように調和するかを考える。複雑な機能の場合は、設計内容をドキュメントにまとめること。

---

### **Phase 3: 実装**

**目的**: 設計に基づき、クリーンで保守性の高いコードを記述する。

コーディング規約を遵守し、一貫性のあるコードを作成する。実装中に設計上の問題に気づいた場合は、立ち止まってPhase 2に戻る勇気を持つこと。

---

### **Phase 4: 品質保証**

**目的**: 実装したコードが期待通りに動作し、既存の機能を破壊しないことを保証する。

「テストなきコードはレガシーコードである」という原則に基づき、必ずテストコードを記述する。

---

### **Phase 5: レビューとマージ**

**目的**: 第三者の視点からコードの品質を評価し、問題がなければメインブランチに統合する。

Github copilotからのレビューは必ずしも鵜呑みにするのではなく、本当に対応すべきかを考察する。

- **参照ドキュメント**:
  - **PR・マージ手順**: `docs/30.quality/3002.git-pr.md`
  - **PRテンプレート**: `.github/PULL_REQUEST_TEMPLATE.md`

---

### **Phase 6: ドキュメント更新と知識共有**

**目的**: プロジェクトを最新かつ健全な状態に保ち、得られた知見をチームの資産とする。

コードを書き終えたら、開発は終わりではない。変更に伴い古くなったドキュメントを更新する。

- **参照ドキュメント**:
  - **知見の蓄積**: `docs/70.knowledge/`
  - **作業記録**: `docs/80.dailyReport/`
  - **新規ドキュメント作成**: `docs/99.templates`

---

### **継続的プロセス: リファクタリング**

**目的**: コードベースの健全性を長期的に維持する。

リファクタリングは特定のフェーズではなく、開発プロセス全体を通じて継続的に行われるべき活動である。「動くコード」で満足せず、常によりクリーンなコードを目指すこと。リファクタリングを行う際は、上記のPhase 2〜5のサイクルを小規模に回す意識を持つ。
